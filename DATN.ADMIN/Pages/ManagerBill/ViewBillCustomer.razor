@page "/viewbill"

<MudContainer Class="invoice-container">
    <MudPaper Elevation="3" Class="invoice-paper">
        <div class="invoice-header">
            <h2 class="invoice-title">HÓA ĐƠN THANH TOÁN</h2>
        </div>
        <div class="invoice-body">
            @if (selectedBooking != null)
            {
                <MudText Typo="Typo.h6" Class="invoice-label">Thông tin hóa đơn</MudText>
                <MudText Typo="Typo.body2" Class="invoice-info">
                    <span><b>Mã hóa đơn:</b> HD-001</span><br />
                    <span><b>Ngày tạo:</b> @DateTime.Now.ToString("dd/MM/yyyy HH:mm")</span><br />
                    <span><b>Khách hàng:</b> @selectedBooking.NameCustomer</span><br />
                    <span><b>Số điện thoại:</b> @selectedBooking.PhoneNumber</span><br />
                    <span><b>Địa chỉ:</b> @selectedBooking.Address</span><br />
                </MudText>

                <MudText Typo="Typo.h6" Class="invoice-label">Danh sách dịch vụ</MudText>
                <MudTable Items="@selectedBooking.Services" Class="invoice-table">
                    <HeaderContent>
                        <MudTh>Tên dịch vụ</MudTh>
                        <MudTh>Đơn giá</MudTh>
                        <MudTh>Số lượng</MudTh>
                        <MudTh>Tổng cộng</MudTh>
                    </HeaderContent>
                    <RowTemplate Context="service">
                        <MudTd>@service.ServiceName</MudTd>
                        <MudTd>@service.UnitPrice.ToString("C0")</MudTd>
                        <MudTd>@service.Quantity</MudTd>
                        <MudTd>@(service.UnitPrice * service.Quantity).ToString("C0")</MudTd>
                    </RowTemplate>
                </MudTable>

                <div class="invoice-total">
                    <span><b>Tổng tiền:</b> @selectedBooking.TotalAmount.ToString("C0")</span>
                </div>

                <MudDivider />

          @*       <MudText Typo="Typo.h6" Class="invoice-label">Thông tin thanh toán</MudText>
                <MudTextField Label="Phương thức thanh toán" @bind-Value="paymentInfo.PaymentMethod" Required="true" />
                <MudNumericField Label="Số tiền thanh toán" @bind-Value="paymentInfo.AmountPaid" Required="true" />
                <MudDatePicker Label="Ngày thanh toán" @bind-Date="paymentInfo.PaymentDate" Required="true" />
                <MudTextField Label="Ghi chú" @bind-Value="paymentInfo.Notes" Multiline="true" /> *@

                <div class="invoice-actions">
                    <MudButton Color="Color.Primary" @onclick="ConfirmPayment">Xác nhận thanh toán</MudButton>
                    <MudButton Color="Color.Secondary" @onclick="Close">Hủy bỏ</MudButton>
                </div>
            }
            else
            {
                <div class="no-invoice">
                    <MudTypography Typo="Typo.body2">Không có hóa đơn nào được chọn.</MudTypography>
                </div>
            }
        </div>
    </MudPaper>
</MudContainer>

@code {
    private List<InvoiceItem> services = new List<InvoiceItem>
    {
        new InvoiceItem { ServiceName = "Dịch vụ A", UnitPrice = 100000, Quantity = 2 },
        new InvoiceItem { ServiceName = "Dịch vụ B", UnitPrice = 150000, Quantity = 1 },
        new InvoiceItem { ServiceName = "Dịch vụ C", UnitPrice = 80000, Quantity = 3 }
    };

    private Bill selectedBooking;
    

    private async Task ConfirmPayment()
    {
        // Xử lý xác nhận thanh toán ở đây
        // Sau khi xác nhận, có thể gọi API hoặc lưu dữ liệu
        Console.WriteLine("Confirmed payment");
    }

    private void Close()
    {
        // Đóng dialog thanh toán
        Console.WriteLine("Closed payment dialog");
    }
    public class InvoiceItem
    {
        public string ServiceName { get; set; }
        public decimal UnitPrice { get; set; }
        public int Quantity { get; set; }
    }

    public class Bill
    {
        public string NameCustomer { get; set; } = "Nguyễn Văn A";
        public string PhoneNumber { get; set; } = "0123456789";
        public string Address { get; set; } = "123 Đường ABC, Quận XYZ, TP HCM";
        public List<InvoiceItem> Services { get; set; }
        public decimal TotalAmount => Services.Sum(s => s.UnitPrice * s.Quantity);
    }
}


